DOCNAME = SSDC-TR-000

GITVERSION := $(shell git log -1 --date=short --pretty=%h)
GITDATE := $(shell git log -1 --date=short --pretty=%ad)
GITSTATUS := $(shell git status --porcelain)
ifneq "$(GITSTATUS)" ""
	GITDIRTY = -dirty
endif

export TEXMFHOME ?= ../../texmf

$(DOCNAME).pdf: $(DOCNAME).tex meta.tex
	latexmk -xelatex -bibtex -interaction=nonstopmode $(DOCNAME).tex

.PHONY: clean
clean:
	latexmk -c
	rm -f $(DOCNAME).{pdf,bbl}
	rm -f meta.tex

.FORCE:

meta.tex: Makefile .FORCE
	rm -f $@
	touch $@
	printf '%% AUTO-GENERATED by Makefile\n' >>$@
	printf '\\newcommand{\\vcsRevision}{$(GITVERSION)$(GITDIRTY)}\n' >>$@
	printf '\\newcommand{\\vcsDate}{$(GITDATE)}\n' >>$@
